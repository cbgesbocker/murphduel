<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MurphDuel - Fantasy Football Leaderboards</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="stars-bg"></div>
    
    <header>
        <nav class="navbar">
            <div class="logo-container">
                <div class="logo">üèà MurphDuel</div>
                <p class="tagline">Fantasy Football War</p>
            </div>
            <div class="status-bar">
                <span id="sheetStatus">üîÑ Loading...</span>
            </div>
        </nav>
    </header>

    <main>
        <!-- Leaderboard Section at TOP -->
        <section class="leaderboard-section hero-leaderboard">
            <div class="leaderboard-header">
                <h1 id="seasonTitle">Final Standings</h1>
                <div class="header-controls">
                    <div class="year-buttons-inline" id="yearButtons">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="leaderboard-container">
                <table class="leaderboard-table" id="leaderboardTable">
                    <thead>
                        <tr>
                            <th class="rank">Rank</th>
                            <th class="name">Manager</th>
                            <th class="team">Team Name</th>
                            <th class="points">Final Points</th>
                            <th class="trophy">Prize</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Seasons</h3>
                    <p class="stat-number" id="totalSeasons">0</p>
                </div>
                <div class="stat-card">
                    <h3>Managers</h3>
                    <p class="stat-number" id="totalManagers">0</p>
                </div>
                <div class="stat-card">
                    <h3>Champions</h3>
                    <p class="stat-number" id="totalChampions">0</p>
                </div>
                <div class="stat-card">
                    <h3>Points Scored</h3>
                    <p class="stat-number" id="totalPoints">0</p>
                </div>
            </div>
        </section>

        <!-- Hall of Fame -->
        <section class="hall-of-fame">
            <h2>üèÜ Hall of Fame üèÜ</h2>
            <div class="champions-list" id="championsList">
                <!-- Populated by JavaScript -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2026 MurphDuel Fantasy Football. Go Bears! üêª</p>
    </footer>

    <script>
        // Google Sheets Configuration
        const SHEET_ID = 'YOUR_GOOGLE_SHEET_ID'; // You'll need to set this
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

        // Load data from Google Sheets or fallback to JSON
        async function loadData() {
            try {
                // Try loading from Google Sheets
                const response = await fetch(SHEET_URL);
                if (response.ok) {
                    const csv = await response.text();
                    const data = parseCSV(csv);
                    updateUI(data);
                    document.getElementById('sheetStatus').textContent = '‚úÖ Live from Google Sheets';
                    return;
                }
            } catch (error) {
                console.log('Google Sheets not configured, using local data');
            }

            // Fallback to local JSON
            try {
                const response = await fetch('leaderboard.json');
                const data = await response.json();
                updateUI(convertJSONToData(data));
                document.getElementById('sheetStatus').textContent = 'üìÑ Local Data';
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('sheetStatus').textContent = '‚ùå Error loading data';
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            const seasons = {};

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index];
                });

                const year = row.year;
                if (!year) continue;

                if (!seasons[year]) {
                    seasons[year] = [];
                }

                seasons[year].push({
                    manager: row.manager,
                    teamName: row.teamname || row.team,
                    points: parseFloat(row.points)
                });
            }

            // Sort each season by points descending
            Object.keys(seasons).forEach(year => {
                seasons[year].sort((a, b) => b.points - a.points);
            });

            return { seasons: Object.keys(seasons).sort().reverse().map(year => ({
                year: parseInt(year),
                leaderboard: seasons[year]
            })) };
        }

        function convertJSONToData(data) {
            return data;
        }

        function updateUI(data) {
            renderYearButtons(data.seasons);
            renderLeaderboard(data.seasons[0]);
            calculateStats(data.seasons);
            renderHallOfFame(data.seasons);
        }

        loadData();

        function renderYearButtons(seasons) {
            const container = document.getElementById('yearButtons');
            container.innerHTML = '';
            seasons.forEach((season, index) => {
                const button = document.createElement('button');
                button.className = 'year-btn' + (index === 0 ? ' active' : '');
                button.textContent = season.year;
                button.onclick = () => {
                    document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    renderLeaderboard(season);
                };
                container.appendChild(button);
            });
        }

        function renderLeaderboard(season) {
            document.getElementById('seasonTitle').textContent = `${season.year} Final Standings`;
            document.getElementById('seasonDesc').textContent = season.description || '';
            
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';

            season.leaderboard.forEach((entry, index) => {
                const row = document.createElement('tr');
                row.className = index === 0 ? 'champion' : index === 1 ? 'runner-up' : '';
                
                const trophy = getTrophy(index);
                
                row.innerHTML = `
                    <td class="rank">${getMedalEmoji(index)} ${index + 1}</td>
                    <td class="name">${entry.manager}</td>
                    <td class="team">${entry.teamName}</td>
                    <td class="points">${entry.points.toFixed(2)}</td>
                    <td class="trophy">${trophy}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getMedalEmoji(rank) {
            if (rank === 0) return 'ü•á';
            if (rank === 1) return 'ü•à';
            if (rank === 2) return 'ü•â';
            return '';
        }

        function getTrophy(rank) {
            if (rank === 0) return 'üèÜ Champion';
            if (rank === 1) return '2nd Place';
            if (rank === 2) return '3rd Place';
            return '';
        }

        function calculateStats(seasons) {
            const uniqueManagers = new Set();
            let totalPoints = 0;
            let totalChampions = 0;

            seasons.forEach(season => {
                season.leaderboard.forEach((entry, index) => {
                    uniqueManagers.add(entry.manager);
                    totalPoints += entry.points;
                    if (index === 0) totalChampions++;
                });
            });

            document.getElementById('totalSeasons').textContent = seasons.length;
            document.getElementById('totalManagers').textContent = uniqueManagers.size;
            document.getElementById('totalChampions').textContent = totalChampions;
            document.getElementById('totalPoints').textContent = totalPoints.toFixed(0);
        }

        function renderHallOfFame(seasons) {
            const champions = {};

            seasons.forEach(season => {
                const champion = season.leaderboard[0];
                if (!champions[champion.manager]) {
                    champions[champion.manager] = [];
                }
                champions[champion.manager].push({
                    year: season.year,
                    points: champion.points,
                    teamName: champion.teamName
                });
            });

            const container = document.getElementById('championsList');
            container.innerHTML = '';

            Object.entries(champions)
                .sort((a, b) => b[1].length - a[1].length)
                .forEach(([manager, wins]) => {
                    const card = document.createElement('div');
                    card.className = 'champion-card';
                    
                    const yearsText = wins.map(w => w.year).join(', ');
                    const winCount = wins.length > 1 ? `${wins.length}-Time Champion` : 'Champion';
                    
                    card.innerHTML = `
                        <div class="champion-trophy">üëë</div>
                        <h3>${manager}</h3>
                        <p class="win-count">${winCount}</p>
                        <p class="years">${yearsText}</p>
                    `;
                    container.appendChild(card);
                });
        }
    </script>
</body>
</html>
